---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getAllPosts, getPostsBySeries } from '../../utils/posts';

export async function getStaticPaths() {
  const posts = await getAllPosts();
  const seriesSlugs = new Set<string>();
  posts.forEach((p) => {
    if (p.data.series) seriesSlugs.add(p.data.series);
  });

  return Array.from(seriesSlugs).map((slug) => ({
    params: { series: slug },
  }));
}

const { series } = Astro.params;
const posts = await getPostsBySeries(series!);

const seriesTitle = series!
  .split('-')
  .map((w: string) => w.charAt(0).toUpperCase() + w.slice(1))
  .join(' ');
---

<BaseLayout title={`${seriesTitle} | TradeLog.dev`}>
  <h1 style="font-size: 2rem; font-weight: 800; color: var(--text-heading); margin-bottom: 8px;">{seriesTitle}</h1>
  <p style="color: var(--text-muted); font-family: var(--font-mono); font-size: 0.875rem; margin-bottom: 32px;">
    {posts.length}개의 포스트
  </p>

  <div class="cards-grid">
    {posts.map((post) => (
      <PostCard
        slug={post.id}
        title={post.data.title}
        description={post.data.description}
        pubDate={post.data.pubDate}
        category={post.data.category}
        lang={post.data.lang}
        tags={post.data.tags}
        body={post.body}
      />
    ))}
  </div>
</BaseLayout>
