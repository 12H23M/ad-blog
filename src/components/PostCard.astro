---
import CategoryBadge from './CategoryBadge.astro';
import { categoryColors } from '../utils/posts';

interface Props {
  slug: string;
  title: string;
  description: string;
  pubDate: string;
  category: string;
  lang: 'ko' | 'en';
  tags?: string[];
  readingTime?: number;
  body?: string;
}

const { slug, title, description, pubDate, category, lang, tags, readingTime, body } = Astro.props;

function formatDate(dateStr: string, lang: string): string {
  const date = new Date(dateStr);
  if (lang === 'ko') {
    return `${date.getFullYear()}. ${date.getMonth() + 1}. ${date.getDate()}.`;
  }
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
}

// Calculate reading time from body if not provided
let rt = readingTime;
if (!rt && body) {
  const words = body.split(/\s+/).length;
  rt = Math.max(1, Math.ceil(words / 200));
}

const readingLabel = lang === 'ko' ? '분 소요' : 'min read';
const catColor = categoryColors[category] || '#00D4FF';
---

<a href={`/blog/${slug}`} class="post-card" data-lang={lang} style={`--card-cat-color: ${catColor}`}>
  <div class="post-card-color-bar"></div>
  <div class="post-card-body">
    <div class="post-card-top">
      <CategoryBadge category={category} lang={lang} />
      <span class="lang-badge">{lang === 'ko' ? '한국어' : 'EN'}</span>
    </div>
    <h3 class="post-card-title">{title}</h3>
    <p class="post-card-desc">{description}</p>
    <div class="post-card-meta">
      <span>{formatDate(pubDate, lang)}</span>
      {rt && <span>&middot; {rt}{readingLabel}</span>}
    </div>
  </div>
</a>
